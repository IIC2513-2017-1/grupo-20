<div class="user-view">
<%if current_user == @user%>
<div class="tab">
  <button class="see-info defaultOpen">Informacion personal</button>
  <button class="see-following">Siguiendo</button>
  <button class="see-followers">Te Siguen</button>
</div>
<div class="profile">
  <h2>Bienvenido <%= @user.name %></h2>
  <%= image_tag(@user.avatar.thumb.url) %>
  <div class="info">
    <p> Email: <%= @user.mail %></p>
    <opt class="button"><%= button_to 'Editar Perfil', edit_user_path(@user), method: "get", class: "buttonEdit"%></opt>
</div>
    <%unless @user.admin%>
    <div class="following">
      <p>Siguiendo:
        <% @user.following.each do |f| %>
          <p class="showing"><%=f.name%></p>
        <%end%>
      </p>
    </div>
      <div class="followers">
      <p>Seguidores:
        <% n_followers = @user.followers.count() %>
        <% count = 0 %>
        <% @user.followers.each do |f| %>
          <% count += 1 %>
          <% if count == n_followers%>
              <%= f.name + '.' %>
          <% else %>
              <%= f.name + ', ' %>
          <%end%>
        <%end%>
      </p>
    </div>
    <%end%>

</div>
<%end%>
<%if current_user == @user%>
<div class="tab">
  <button class="see-own defaultOpen">Rifas Creadas</button>
  <button class="see-bought">Rifas Compradas</button>
  <button class="see-processing">Rifas siendo procesadas</button>
</div>
<%end%>
<%unless @user.admin%>
<div class="own-raffles">
      <%if current_user == @user%>
        <h2>Tus Rifas Creadas</h2>
        <go class="button"><%= button_to 'Crear Rifa', new_user_rifa_path(current_user.id), method: "get", class: "buttonNew"%></go>
      <%end%>
      <%unless current_user == @user%>
        <h2>Rifas creadas por <%=@user.name%>
          <%if current_user%>
          <%if Follow.where("follower_id  = ? AND following_id = ?", current_user.id,  @user.id).blank?%>
            <%unless current_user == @user%>
                <h3><%=link_to 'Seguir a este usuario', user_followers_path(@user)%></h3>
            <%end%>
          <%end%>
          <%unless Follow.where("follower_id  = ? AND following_id = ?", current_user.id,  @user.id).blank?%>
          <h3>Ya sigues a <%=@user.name%>!</h3>
          <h3>Calificación: <%=@valoracion%></h3>
          <h3>
          <%= form_for @rating, url:{ controller: :ratings, action: :create } do |f|%>
          <%= f.label :calificar%>
          <%= f.select :valoracion, ((1..5).map {|i| [i,i] })%>
          <%= f.submit "calificar"%>
          <%end%>
          </h3>
          <%end%>
          <%end%>
        </h2>
      <%end%>
      <% @user.rifas.each do |d| %>
      <div class="raffle" id="own">
        <edit class="button"><%= button_to 'Editar Rifa', edit_user_rifa_path(@user.id), method: "get", class: "buttonTo"%></edit>
        <h3> Rifa <%= d.title %><br></h3>
        <ul>
          <li>Premios:
          <% n_prizes = d.prizes.count() %>
          <% count = 0 %>
          <% d.prizes.each do |prize| %>
            <% count += 1 %>
            <% if count == n_prizes%>
                <%= prize.name + '.' %>
            <% else %>
                <%= prize.name + ', ' %>
            <%end%>
          <%end%>
        </li>
          <li>Fecha de inicio: <%= d.created_at %></li>
          <li>Fecha de de termino: <%= d.end_date %></li>
          <li>Precio: <%= d.price %></li>
          <li>Numeros restantes: <%= d.numbers%></li>
          <%if current_user%>
          <%unless @user == current_user%>
          <%= button_to 'Comprar Rifa', new_rifa_numero_path(d.id), method: "get"%>
          <%= button_to 'Ver Rifa', rifa_path(d.id), method: "get"%>
          <%end%>
          <%end%>
        </ul>
        <%if @user == current_user%>
        <go class="button"><%= button_to 'Generar Sorteo', rifas_draw_path(d.id), method: "get", class: "buttonRaff"%></go>
        <%end%>
      </div>
      <% end %>
</div>
<div class="bought-raffles">
      <%if current_user == @user%>
        <h2>Tus Rifas Compradas</h2>
      <% @user.numeros.each do |d| %>
      <%if d.aproved%>
      <div class="raffle" id="own">
        <%@rifa = Rifa.find(d.rifa_id)%>
        <h3> Rifa <%= @rifa.title %><br></h3>
        <ul>
          <li>Premios:
          <% n_prizes = @rifa.prizes.count() %>
          <% count = 0 %>
          <% @rifa.prizes.each do |prize| %>
            <% count += 1 %>
            <% if count == n_prizes%>
                <%= prize.name + '.' %>
            <% else %>
                <%= prize.name + ', ' %>
            <%end%>
          <%end%>
        </li>
          <li>Dueño: <%=@rifa.owner%></li>
          <li>Fecha de inicio: <%= @rifa.created_at %></li>
          <li>Fecha de de termino: <%= @rifa.end_date %></li>
          <li>Precio: <%= @rifa.price %></li>
          <li>Numeros restantes: <%= @rifa.numbers%></li>
          <li>Tu numero: <%= d.number%></li>
        </ul>
      </div>
      <% end %>
      <%end%>
      <%end%>
</div>
<div class="processing-raffles">
      <%if current_user == @user%>
        <h2>Compras siendo procesadas por Administrador</h2>
      <% @user.numeros.each do |d| %>
      <%unless d.aproved%>
      <div class="raffle" id="own">
        <%@rifa = Rifa.find(d.rifa_id)%>
        <h3> Rifa <%= @rifa.title %><br></h3>
        <ul>
          <li>Premios:
          <% n_prizes = @rifa.prizes.count() %>
          <% count = 0 %>
          <% @rifa.prizes.each do |prize| %>
            <% count += 1 %>
            <% if count == n_prizes%>
                <%= prize.name + '.' %>
            <% else %>
                <%= prize.name + ', ' %>
            <%end%>
          <%end%>
        </li>
          <li>Dueño: <%=@rifa.owner%></li>
          <li>Fecha de inicio: <%= @rifa.created_at %></li>
          <li>Fecha de de termino: <%= @rifa.end_date %></li>
          <li>Precio: <%= @rifa.price %></li>
          <li>Numeros restantes: <%= @rifa.numbers%></li>
          <li>Tu numero: <%= d.number%></li>
        </ul>
      </div>
      <% end %>
      <%end%>
      <%end%>
</div>
<%end%>
<%if @user.admin%>
<div class="own-raffles">
      <h2>Compras pendientes por aprobación</h2>
      <% @numeros.each do |num| %>
      <%unless num.aproved%>
      <div class="raffle" id="own">
        <%@d = Rifa.find(num.rifa_id)%>
        <h3> Rifa <%= @d.title %><br></h3>
        <ul>
          <li>Premios:
          <% n_prizes = @d.prizes.count() %>
          <% count = 0 %>
          <% @d.prizes.each do |prize| %>
            <% count += 1 %>
            <% if count == n_prizes%>
                <%= prize.name + '.' %>
            <% else %>
                <%= prize.name + ', ' %>
            <%end%>
          <%end%>
        </li>
          <li>Fecha de inicio: <%= @d.created_at %></li>
          <li>Fecha de de termino: <%= @d.end_date %></li>
          <li>Precio: <%= @d.price %></li>
          <li>Numeros restantes: <%= @d.numbers%></li>
          <li>Dueño de la rifa: <b><%= User.find(@d.user_id).name%></b></li>
          <li>Comprador del numero: <b><%= User.find(num.user_id).name%></b></li>
          <li>Numero comprado: <%= num.number%></li>
          <li class="button"><%= button_to 'Aprobar compra', aprove_compra_path(num.id)%></li>
        </ul>
      </div>
      <%end%>
      <%end%>
<%end%>
</div>
</div>
